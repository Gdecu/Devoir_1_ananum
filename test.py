import numpy as np

def givens_rotation(a, b):
    """Compute the Givens rotation matrix elements c and s such that:
    G @ [a, b]ᵀ = [r, 0]ᵀ
    """
    if b == 0:
        return 1, 0
    elif abs(b) > abs(a):
        tau = -a / b
        s = 1 / np.sqrt(1 + tau**2)
        c = s * tau
    else:
        tau = -b / a
        c = 1 / np.sqrt(1 + tau**2)
        s = c * tau
    return c, s

def tridiagonalize(A):
    """Transform a symmetric band matrix A into a tridiagonal matrix using Givens rotations."""
    n = A.shape[0]
    A = A.copy()
    d = np.zeros(n)
    e = np.zeros(n)
    
    for j in range(n - 2):
        for i in range(j + 2, n):
            if A[i, j] != 0:
                c, s = givens_rotation(A[j + 1, j], A[i, j])
                
                # Apply rotation on rows (left multiplication)
                for k in range(j, n):
                    A_jk, A_ik = A[j + 1, k], A[i, k]
                    A[j + 1, k] = c * A_jk - s * A_ik
                    A[i, k] = s * A_jk + c * A_ik
                
                # Apply rotation on columns (right multiplication)
                for k in range(n):
                    A_kj, A_ki = A[k, j + 1], A[k, i]
                    A[k, j + 1] = c * A_kj - s * A_ki
                    A[k, i] = s * A_kj + c * A_ki
    
    # Extract diagonal and sub-diagonal
    d[:] = np.diag(A)
    e[:-1] = np.diag(A, k=1)
    
    return d, e[:-1]

# Test avec la matrice donnée
"""A = np.array([
    [  3,  6,  9, 12,  0,  0,  0],
    [  6,  7, 10, 13, 16,  0,  0],
    [  9, 10, 11, 14, 17, 20,  0],
    [ 12, 13, 14, 15, 18, 21, 25],
    [  0, 16, 17, 18, 19, 22, 24],
    [  0,  0, 20, 21, 22, 23, 26],
    [  0,  0,  0, 24, 25, 26, 27]
], dtype=float)"""

"""A = np.array([
    [2.0000, 4.0000, 6.0000, 0.0000, 0.0000, 0.0000],
    [4.0000, 5.0000, 7.0000, 9.0000, 0.0000, 0.0000],
    [6.0000, 7.0000, 8.0000, 10.0000, 12.0000, 0.0000],
    [0.0000, 9.0000, 10.0000, 11.0000, 13.0000, 15.0000],
    [0.0000, 0.0000, 12.0000, 13.0000, 14.0000, 16.0000],
    [0.0000, 0.0000, 0.0000, 15.0000, 16.0000, 17.0000]
], dtype=float)"""

# print eigvals(A)

"""A = np.array([
    [2.0000, 4.0000, 6.0000, 0.0000],
    [4.0000, 5.0000, 7.0000, 9.0000],
    [6.0000, 7.0000, 8.0000, 10.0000],
    [0.0000, 9.0000, 10.0000, 11.0000]
], dtype=float)"""

A = np.array([
    [   5.0000,   10.0000,   15.0000,   20.0000,   25.0000,   30.0000,    0.0000,    0.0000,    0.0000,    0.0000],
    [  10.0000,   11.0000,   16.0000,   21.0000,   26.0000,   31.0000,   36.0000,    0.0000,    0.0000,    0.0000],
    [  15.0000,   16.0000,   17.0000,   22.0000,   27.0000,   32.0000,   37.0000,   42.0000,    0.0000,    0.0000],
    [  20.0000,   21.0000,   22.0000,   23.0000,   28.0000,   33.0000,   38.0000,   43.0000,   48.0000,    0.0000],
    [  25.0000,   26.0000,   27.0000,   28.0000,   29.0000,   34.0000,   39.0000,   44.0000,   49.0000,   54.0000],
    [  30.0000,   31.0000,   32.0000,   33.0000,   34.0000,   35.0000,   40.0000,   45.0000,   50.0000,   55.0000],
    [   0.0000,   36.0000,   37.0000,   38.0000,   39.0000,   40.0000,   41.0000,   46.0000,   51.0000,   56.0000],
    [   0.0000,    0.0000,   42.0000,   43.0000,   44.0000,   45.0000,   46.0000,   47.0000,   52.0000,   57.0000],
    [   0.0000,    0.0000,    0.0000,   48.0000,   49.0000,   50.0000,   51.0000,   52.0000,   53.0000,   58.0000],
    [   0.0000,    0.0000,    0.0000,    0.0000,   54.0000,   55.0000,   56.0000,   57.0000,   58.0000,   59.0000]
], dtype=float)

v = np.linalg.eig(A)
d, e = tridiagonalize(A)

#print("A :\n", A)
A = np.diag(d) + np.diag(e, k=1) + np.diag(e, k=-1)
#print("Tridiaganlize(A) :\n")
#for i in range(len(A)):
    #for j in range(len(A[0])):
        #print(f"{A[i][j]:7.2f}  ", end=" ")
    #print()
#print()
#print("eigenvalues(tridiagonalize(A)) :", np.linalg.eigvals(A))
#print("Diagonale principale :", d)
#print("Sous-diagonale :", e)

T = np.array([
    [2.1896, 3.8350, 5.2970, 4.1749, 5.2693, 9.1032, 0.0000, 0.0000, 0.0000, 0.0000],
    [3.8350, 5.1942, 6.7115, 6.8677, 0.9196, 7.6220, 6.3264, 0.0000, 0.0000, 0.0000],
    [5.2970, 6.7115, 0.0770, 5.8898, 6.5392, 2.6245, 7.5641, 7.2266, 0.0000, 0.0000],
    [4.1749, 6.8677, 5.8898, 9.3044, 4.1600, 0.4746, 9.9104, 7.5336, 2.7271, 0.0000],
    [5.2693, 0.9196, 6.5392, 4.1600, 7.0119, 7.3608, 3.6534, 6.5152, 4.3641, 3.5926],
    [9.1032, 7.6220, 2.6245, 0.4746, 7.3608, 3.2823, 2.4704, 0.7269, 7.6649, 1.6651],
    [0.0000, 6.3264, 7.5641, 9.9104, 3.6534, 2.4704, 9.8255, 6.3163, 4.7773, 4.8652],
    [0.0000, 0.0000, 7.2266, 7.5336, 6.5152, 0.7269, 6.3163, 8.8471, 2.3777, 8.9766],
    [0.0000, 0.0000, 0.0000, 2.7271, 4.3641, 7.6649, 4.7773, 2.3777, 2.7491, 9.0921],
    [0.0000, 0.0000, 0.0000, 0.0000, 3.5926, 1.6651, 4.8652, 8.9766, 9.0921, 0.6056]
])

# Compute the eigenvalues of the tridiagonal matrix
eigenvalues = np.linalg.eigvals(T)
print("Eigenvalues of the tridiagonal matrix:", eigenvalues)
